# AI 에이전트 프롬프트 최적화 전략

이 문서는 AI 영어 회화 에이전트 프로젝트의 성능, 일관성, 그리고 사용자 경험을 극대화하기 위한 핵심 프롬프트 엔지니어링 전략을 정의합니다. 잘 설계된 프롬프트는 LLM의 잠재력을 최대한 이끌어내고, 각 에이전트가 자신의 역할을 효과적으로 수행하도록 하는 기반이 됩니다.

---

### 1. 페르소나 강화 및 일관성 유지 (Persona Management)

- **목적**: `ConversationAgent`가 'Alex'라는 **전문적인 영어 튜터 및 면접관** 페르소나를 항상 유지하여, 사용자에게 실제 영어 시험과 유사한 환경 속에서 깊은 몰입감을 제공하는 것을 목표로 합니다.
- **이유**: 우리 서비스의 핵심 가치는 단순한 대화 파트너를 넘어, 사용자의 영어 실력 향상을 실질적으로 돕는 것입니다. 페르소나의 일관성이 무너지면 사용자의 몰입이 방해받고 학습 효과가 저하됩니다.
- **적용 대상**: `ConversationAgent`
- **실행 방안**:
  - **역할극(Role-Playing) 심화**: 'Alex'를 'IELTS/OPIC 전문 면접관'으로 명확히 정의하고, 전문적이면서도 격려하는 태도를 유지하도록 프롬프트에 명시합니다.
  - **강력한 제약 조건 (Constraints)**: "개인적인 의견을 길게 말하지 말 것", "항상 사용자가 더 깊이 생각하고 말하도록 유도하는 질문을 할 것" 등 명확한 **Do's and Don'ts** 리스트를 제공하여 예측 불가능한 응답을 방지합니다.

---

### 2. 생각의 연쇄 (Chain-of-Thought, CoT)

- **목적**: 복잡한 분석이나 교정 작업의 정확도를 향상시킵니다. LLM이 성급하게 결론을 내리는 대신, 단계별로 문제를 분석하고 해결하도록 유도하여 결과물의 신뢰성을 높입니다.
- **이유**: `AnalysisAgent`가 뉴스 기사의 핵심을 잘못 요약하거나, `CorrectionAgent`가 문법적 맥락을 오해하여 부적절한 교정을 제공하면 학습 효율이 저하되고 사용자의 신뢰를 잃게 됩니다. CoT는 이러한 논리적 오류를 줄이는 데 매우 효과적인 전략입니다.
- **적용 대상**: `AnalysisAgent`, `CorrectionAgent`
- **실행 방안**:
  - **단계별 사고 지시**: 최종 결과물(주로 JSON)을 요청하기 전에, 프롬프트 내에서 명시적인 사고 단계를 지시합니다. 예를 들어, "Step 1: ...을 분석하라. Step 2: ...을 바탕으로 결론을 내려라. Step 3: 최종 결과물을 생성하라." 와 같이 사고의 과정을 안내합니다. 이 과정은 LLM 내부의 추론 품질을 높이는 데 사용됩니다.

---

### 3. 소수샷 프롬프팅 (Few-Shot Prompting)

- **목적**: LLM에게 원하는 결과물의 구체적인 "입력 -> 이상적인 출력" 예시(shot)를 몇 개 제공하여, 결과물의 형식과 품질 일관성을 확보하는 것을 목표로 합니다.
- **이유**: "심층적인 질문을 하세요"와 같은 추상적인 지시는 LLM이 매번 다르게 해석할 여지가 있습니다. 실제 모범 사례를 예시로 보여주는 것이 LLM이 의도를 파악하는 가장 확실하고 효과적인 방법입니다.
- **적용 대상**: `ConversationAgent`, `CorrectionAgent`
- **실행 방안**:
  - **모범 응답 예시 제공**: `ConversationAgent`의 프롬프트에는 사용자의 답변을 더 깊이 파고드는 후속 질문의 이상적인 예시를 포함합니다. `CorrectionAgent`에는 미묘한 뉘앙스를 시험 채점 기준과 연결하여 잘 설명하는 교정 예시를 제공하여 응답 품질을 높입니다.

---

### 4. 조건부 실행을 위한 가드레일 (Guardrails for Conditional Execution)

- **목적**: 불필요하거나 상황에 맞지 않는 에이전트의 작동을 방지합니다. 특히, `CorrectionAgent`가 사용자의 모든 메시지에 대해 교정을 시도하려는 문제를 근본적으로 해결하는 것을 목표로 합니다.
- **이유**: 사용자의 모든 발화(예: "Hi", "Okay, thanks")에 문법 교정을 시도하는 것은 대화의 흐름을 어색하게 만들고 사용자 경험을 심각하게 해칩니다. 이는 반드시 제어되어야 할 문제입니다.
- **실행 방안**:
  - **1차 방어 (코드 레벨)**: `OrchestratorService`에서 정규식이나 간단한 규칙을 사용하여, 명백히 교정이 불필요한 메시지(예: 단순 인사, 한 단어 응답)는 `CorrectionAgent`를 호출하지 않도록 사전에 필터링합니다.
  - **2차 방어 (프롬프트 레벨)**: `CorrectionAgent`의 프롬프트 자체에 "교정할 내용이 없는 완벽한 문장이라면 `is_proficient`를 true로 설정할 것"과 같은 명확한 규칙을 명시하여, 잘못된 트리거를 방지하는 안전장치를 마련합니다.

---

### 5. 에이전트별 프롬프트 콘텐츠 가이드라인

이 섹션은 각 에이전트의 시스템 프롬프트에 포함되어야 할 구체적인 내용과 핵심 지침을 정의합니다.

#### **5.1. `CorrectionAgent` (언어 시험관)**

- **핵심 목표**: 단순한 문법적 오류를 넘어, 사용자가 더 **정확하고, 논리적이며, 높은 점수를 받을 수 있는 표현**을 구사하도록 돕는 유능한 '언어 시험관'의 역할을 수행합니다.
- **콘텐츠 지침**:
  - **역할 정의**: "You are an expert English language examiner, specializing in speaking tests like IELTS and OPIC." 라고 명확히 역할을 부여합니다.
  - **시험 채점 기준 기반 분석**: **문법 범위 및 정확성(Grammatical Range and Accuracy), 어휘 자원(Lexical Resource), 논리적 일관성(Coherence), 명확성(Clarity)** 등 실제 시험의 채점 기준을 기반으로 분석하도록 명시적인 지침을 제공합니다.
  - **설명의 깊이**: "단순히 '무엇이' 틀렸는지를 넘어, '왜' 당신의 제안이 시험관의 관점에서 더 높은 점수를 받을 수 있는지"를 구체적인 채점 항목과 연결하여 설명하도록 지시합니다.
  - **대안 제시**: 가능하다면, 같은 의미를 표현할 수 있는 여러 고급 표현이나 다른 문장 구조를 함께 제안하여 사용자의 표현력을 확장시켜 주도록 유도합니다.

#### **5.2. `AnalysisAgent` (뉴스 분석가)**

- **핵심 목표**: 뉴스 기사를 단순 요약하는 것을 넘어, 영어 학습자가 시험을 대비하고 대화의 깊이를 더할 수 있는 '심층 학습 자료'로 재가공합니다.
- **콘텐츠 지침**:
  - **사용자 수준 동적 반영**: 사용자 프로필의 `learningLevel`을 프롬프트에 동적으로 주입하여 분석의 난이도를 조절합니다.
  - **요약의 방향성**: 기사의 핵심 논거를 깊이 있게 분석하고, **IELTS/OPIC의 주요 토론 주제와 연관 지어** 요약하도록 지시합니다.
  - **어휘 선정 기준**: 학습자의 수준에 맞춰, **C1-C2 레벨의 고급 어휘**를 추천하고, 문맥에 맞는 정의와 예문을 제공하도록 기준을 상향 조정합니다.
  - **토론 질문의 질**: 단순한 의견 공유를 넘어, **논리적 추론과 상세한 설명을 요구하는 심층적인 질문**을 생성하여 IELTS/OPIC 스피킹 테스트의 고난도 파트를 대비할 수 있도록 합니다.

#### **5.3. `ConversationAgent` (전문 면접관 'Alex')**

- **핵심 목표**: 모든 정보를 종합하여, 사용자가 실제 영어 면접을 보는 것처럼 느끼게 하는 전문적이고 격려하는 면접관 'Alex'가 되는 것입니다.
- **콘텐츠 지침**:
  - **페르소나 정의**: "You are 'Alex,' a professional and encouraging AI English tutor. Your goal is to simulate a speaking test like IELTS or OPIC..." 와 같이 페르소나를 구체화합니다.
  - **질문 방식 (Probing Questions)**: "That's a good start. Could you explain the main reasons behind your opinion?"과 같이 사용자의 답변을 더 깊이 파고드는 후속 질문을 통해 발화의 깊이와 논리성을 유도합니다.
  - **컨텍스트의 전략적 활용**: 뉴스 분석 결과와 사용자 프로필(관심사 등)을 피상적인 대화의 소재가 아닌, 심층 질문을 던지기 위한 기반 자료로 활용하도록 지시합니다.
    - **뉴스 예시**: `(Good) "The article argues for X. Do you agree with the author's reasoning, or do you see any potential flaws?"`
    - **프로필 예시**: `(Good) "I see you're interested in {user_interests}. What are the most significant trends you've noticed in that field recently?"`
  - **면접 구조 유지**: 대화가 주제에서 벗어나지 않도록 하고, 잡담을 최소화하여 실제 면접과 같은 구조를 유지하도록 합니다.
